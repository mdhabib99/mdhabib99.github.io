# GitLab CI to validate HTML and deploy to GitLab Pages

stages:
  - test
  - deploy

validate_html:
  image: ubuntu:22.04
  stage: test
  script:
    - apt-get update && apt-get install -y libxml2-utils
    - xmllint --noout Portfolio-Habib.html
  only:
    - merge_requests
    - main

pages:
  stage: deploy
  script:
    - mkdir public
    - cp Portfolio-Habib.html public/index.html
  artifacts:
    paths:
      - public
  only:
    - main

mirror_to_github:
  stage: deploy
  image: alpine:latest
  script:
    - apk add --no-cache git
    - |
      if [ -z "$GITHUB_PAT" ] || [ -z "$GITHUB_REPO" ]; then
        echo "GITHUB_PAT or GITHUB_REPO not set; skipping mirror to GitHub"
        exit 0
      fi
    - git config --global user.email "ci@example.com"
    - git config --global user.name "CI Mirror"
    - export GITHUB_ACTOR=${GITHUB_ACTOR:-gitlab-ci}
    - git remote add github "https://${GITHUB_ACTOR}:${GITHUB_PAT}@github.com/${GITHUB_REPO}.git" || git remote set-url github "https://${GITHUB_ACTOR}:${GITHUB_PAT}@github.com/${GITHUB_REPO}.git"
    - git push --mirror github
  only:
    - main
